<a id="readme-top"></a>
# Laravel Redis Manager

A tool extending the Redis basic functionality for caching. It is basically used hash stored at key to value of redis
and using the PHP array to map and parse the data.
<!-- TABLE OF CONTENTS -->
<details>
  <summary>Table of Contents</summary>
  <ol>
    <li>
      <a href="#prerequisites">Prerequisites</a>
      <ul>
        <li><a href="#config">Config</a></li>
        <li><a href="#redis-setup">Redis setup</a></li>
        <li><a href="#installation">Installation</a></li>
      </ul>
    </li>
    <li>
        <a href="#getting-started">Getting started </a>
        <ul>
            <li><a href="#proceed-when-down">Proceed when down </a></li>
        </ul>
    </li>
  </ol>
</details>

## [#](#prerequisites) <span id="prerequisites">Prerequisites</span>
- [Laravel Framework](https://laravel.com) 9+ support
- [PHP](https://www.php.net) 8+ support
- [Redis](https://redis.io/) 6+ support

<p align="right">(<a href="#readme-top">back to top</a>)</p>


### [#](#config) <span id="config">Config file</span>
This package publishes a <b>`config/redis-manager.php`</b> file. If you already have a file by that name,  you must rename or remove it to avoid conflict using this package.
<p align="right">(<a href="#readme-top">back to top</a>)</p>

### [#](#) <span id="redis-setup">Redis setup</span>
To setup Redis to your Laravel project visit [Laravel Redis Documentation](https://laravel.com/docs/9.x/redis).
<p align="right">(<a href="#readme-top">back to top</a>)</p>

## [#](#installation) <span id="installation">Installation</span>

1. Install the package via [composer](https://getcomposer.org/download).
  ```sh
  composer require jonreyg/laravel-redis-manager
  ```
2. To publish the package [config](https://github.com/jonreygalera/laravel-redis-manager-dev/blob/main/config/config.php) and [assets](https://github.com/jonreygalera/laravel-redis-manager-dev/tree/main/resources/assets).

  ```sh
  php artisan vendor:publish --provider="Jonreyg\LaravelRedisManager\LaravelRedisManagerServiceProvider"
  ```
3. Clear your config cache.
```sh
php artisan optimize:clear
 # or
php artisan config:clear
```
<p align="right">(<a href="#readme-top">back to top</a>)</p>

## [#](#getting-started) <span id="getting-started">Getting started</span>

### [#](#proceed-when-down) <span id="proceed-when-down">Proceed when down </span>
By default, if there is no connection to the Redis, the system will throw an error when calling all the process (inserting, retrieving , .etc) of this package. If you would like to continue the process even though if there is no connection, you may use the `proceedWhenDown` method. These method should be called from the boot method of your application's `App\Providers\AppServiceProvider` class:

```php
<?php

namespace App\Providers;

use Illuminate\Support\ServiceProvider;
use Jonreyg\LaravelRedisManager\Redis;

class AppServiceProvider extends ServiceProvider
{
    /**
     * Register any application services.
     *
     * @return void
     */
    public function register()
    {
        //

    }

    /**
     * Bootstrap any application services.
     *
     * @return void
     */
    public function boot()
    {
        //
        Redis::proceedWhenDown();
    }
}

```

### [#](#) Generating Redis Manager Classes
First, create a manager class file. The default directory of the redis manager classes live in the `app\RedisManager`. You may use the `make:redismanager` command to generate a new redis manager class.

From the example the `User` set as the name of the redis manager class.

```sh
php artisan make:redismanager User
```
<p align="right">(<a href="#readme-top">back to top</a>)</p>

### [#](#) Generated Redis Manager Classes
Redis Manager generated by the `make:redismanager` command will be placed in the `app\RedisManager` directory.
Example of the generated manager.

```php
<?php

namespace App\RedisManager;

use Jonreyg\LaravelRedisManager\Bridge\RedisManager;

class User extends RedisManager
{
    protected $folder = 'user';
    protected $hash_key = 'id';

    protected $field_key_column = [
        'id' => 'int'
    ];
}

```
<p align="right">(<a href="#readme-top">back to top</a>)</p>

### [#](#) Folder
The protected `$folder` property value will set as the name of the key in Redis. You may change the value if it is necessary.

```php
<?php

namespace App\RedisManager;

use Jonreyg\LaravelRedisManager\Bridge\RedisManager;

class User extends RedisManager
{
    protected $folder = 'user';
}

```
<p align="right">(<a href="#readme-top">back to top</a>)</p>

### [#](#) Hash key
The protected `$hash_key` property value will set as the primary key name of the generated Redis Manager class. You may change the value if it is necessary.

```php
<?php

namespace App\RedisManager;

use Jonreyg\LaravelRedisManager\Bridge\RedisManager;

class User extends RedisManager
{
    protected $hash_key = 'id';
}

```

<p align="right">(<a href="#readme-top">back to top</a>)</p>

### [#](#) Field key column 
The protected `$field_key_column` property value will set as the attributes/column/field name of the generated Redis Manager class. You may change the value if it is necessary. The `$field_key_column` property must contain an array of `column name` as the `key` in the array syntax and `data type` of the `column name` as the  `value` in the array syntax.


```php
<?php

namespace App\RedisManager;

use Jonreyg\LaravelRedisManager\Bridge\RedisManager;

class User extends RedisManager
{
    protected $field_key_column = [
        'id' => 'int',
        'name' => 'string',
        'is_human' => 'bool',
        'current_salary' => 'float',
        'additional_info' => 'array'
    ];
}
```

<strong>Available Data types:</strong>
- int
- string
- float
- array
- bool

```php
[ 'column_name' => 'data_type' ] // eg. [ 'first_name' => 'string', ...array  ]
```
<p align="right">(<a href="#readme-top">back to top</a>)</p>

## [#](#) Usage

Once you have created a redis manager class, you can start inserting, retrieving or deleting data from the Redis storage.

<p align="right">(<a href="#readme-top">back to top</a>)</p>

### [#](#) Inserting data

Inserting data to the redis storage was using the redis function named [hset](https://redis.io/commands/hset/).
To insert data, the redis mananger makes it simple by using the method named `insert`.

> NOTE: Inserting data will either creating a new or will update the current data with same hash key value.

``` php
insert(array $data)
```
<strong>Example</strong>
```php
<?php
 
namespace App\Http\Controllers;
 
use App\Http\Controllers\Controller;
use App\RedisManager\User;
use Illuminate\Http\Request;
 
class UserController extends Controller
{
    /**
     * Store a new user in the redis database.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return \Illuminate\Http\Response
     */
    public function store(Request $request)
    {
        // Validate the request...
 
        $user = new User;
 
        $user->insert([
            'id' => 1,
            'name' => 'Jiaar'
        ]);
        
        # or
        # User::insert([ 'id' => 1, 'name' => 'Jiaar' ]);
 
    }
}


```
<p align="right">(<a href="#readme-top">back to top</a>)</p>

### [#](#) Deleting data

Deleting data to the redis storage was using the redis function named [del](https://redis.io/commands/del/).
To insert data, the redis mananger makes it simple by using the method named `delete`.

``` php
delete(mixed $hash_key_value)
```
Example
```php
<?php
 
namespace App\Http\Controllers;
 
use App\Http\Controllers\Controller;
use App\RedisManager\User;
use Illuminate\Http\Request;
 
class UserController extends Controller
{
    /**
     * Store a new user in the redis database.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return \Illuminate\Http\Response
     */
    public function delete(Request $request)
    {
        // Validate the request...
 
        $user = new User;
 
        $user->delete(1);
        
        # or
        # User::delete(1);
 
    }
}


```

### [#](#) Retrieving data

Once you done inserting data, you may now retrieve all data from the redis database.
Retrieving can be done by using different methods.

<p align="right">(<a href="#readme-top">back to top</a>)</p>

#### [#](#) all

Using `all` method will get all the data from the redis storage.

``` php
all()
```
<strong>Example</strong>
```php
<?php
 
namespace App\Http\Controllers;
 
use App\Http\Controllers\Controller;
use App\RedisManager\User;
use Illuminate\Http\Request;
 
class UserController extends Controller
{
    /**
     * Store a new user in the redis database.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return \Illuminate\Http\Response
     */
    public function delete(Request $request)
    {
        // Validate the request...
 
        $user = new User;
 
        $result = $user->all();
        
        # or
        # $result = User::all();

        return $result;
    }
}


```
<p align="right">(<a href="#readme-top">back to top</a>)</p>

#### [#](#) first

Using `first` method will get the first data from the redis storage.

``` php
all()
```
<strong>Example</strong>
```php
<?php
 
namespace App\Http\Controllers;
 
use App\Http\Controllers\Controller;
use App\RedisManager\User;
use Illuminate\Http\Request;
 
class UserController extends Controller
{
    /**
     * Store a new user in the redis database.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return \Illuminate\Http\Response
     */
    public function delete(Request $request)
    {
        // Validate the request...
 
        $user = new User;
 
        $result = $user->first();
        
        # or
        # $result = User::first();

        return $result;
    }
}


```

<p align="right">(<a href="#readme-top">back to top</a>)</p>

#### [#](#) paginate

Using `paginate` method will get all the data from the redis storage by specifying the number of items you would displayed per page.

``` php
paginate($offset = 0, $limit = 15, bool $data_only = false)

```
<strong>Parameters</strong>
<b>offset</b>
The sequence that the data will start.

<b>limit</b>
The number of items to shown from specified number of offset to limit value.
> <b>NOTE:</b> negative value will get all available data from the redis storage.

<b>data_only</b>
Either showing the additional information (except for data key) or not.


<strong>Example</strong>
```php
<?php
 
namespace App\Http\Controllers;
 
use App\Http\Controllers\Controller;
use App\RedisManager\User;
use Illuminate\Http\Request;
 
class UserController extends Controller
{
    /**
     * Store a new user in the redis database.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return \Illuminate\Http\Response
     */
    public function delete(Request $request)
    {
        // Validate the request...
 
        $user = new User;
 
        $result = $user->paginate(0, 15);
        
        # or
        # $result = User::paginate(0, 15, true);

        return $result;
    }
}


```
<p align="right">(<a href="#readme-top">back to top</a>)</p>

#### [#](#) limit

Using `limit` method is used to specify the number of data to return and using the `get` method to show the data.

``` php
limit(int $limit)

```

<strong>Example</strong>
```php
<?php
 
namespace App\Http\Controllers;
 
use App\Http\Controllers\Controller;
use App\RedisManager\User;
use Illuminate\Http\Request;
 
class UserController extends Controller
{
    /**
     * Store a new user in the redis database.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return \Illuminate\Http\Response
     */
    public function delete(Request $request)
    {
        // Validate the request...
 
        $user = new User;
 
        $result = $user->limit(15)->get();
        
        # or
        # $result = User::limit(15)->get();

        return $result;
    }
}


```
You can also chain the method `offset` to set the sequence of data that will start.
``` php
offset(int $offset)

```

<strong>Example limit and offset</strong>
```php
<?php
 
namespace App\Http\Controllers;
 
use App\Http\Controllers\Controller;
use App\RedisManager\User;
use Illuminate\Http\Request;
 
class UserController extends Controller
{
    /**
     * Store a new user in the redis database.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return \Illuminate\Http\Response
     */
    public function delete(Request $request)
    {
        // Validate the request...
 
        $user = new User;
 
        $result = $user->offset(0)->limit(15)->get();
        
        # or
        # $result = User::offset(0)->limit(15)->get();

        return $result;
    }
}
```
<p align="right">(<a href="#readme-top">back to top</a>)</p>

### [#](#) Order by
Sort the redis return data.

```php
orderBy($order_by, string $sort_by = 'ASC')
```
<strong>Parameters</strong>
<strong>order_by</strong>
Set the name of the field_key_column name to be sort.
<strong>sort_by</strong>
The order used to sort the data, either `ASC` or `DESC` value.

<strong>Example</strong>
```php
<?php
 
namespace App\Http\Controllers;
 
use App\Http\Controllers\Controller;
use App\RedisManager\User;
use Illuminate\Http\Request;
 
class UserController extends Controller
{
    /**
     * Store a new user in the redis database.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return \Illuminate\Http\Response
     */
    public function delete(Request $request)
    {
        // Validate the request...
 
        $user = new User;
 
        $result = $user->orderBy('id', 'DESC')->get();
        
        # or
        # $result = User::offset(0)->limit(15)->orderBy('id', 'DESC')->get();

        return $result;
    }
}

```
<p align="right">(<a href="#readme-top">back to top</a>)</p>

### [#](#) Where method

<p align="right">(<a href="#readme-top">back to top</a>)</p>

### [#](#) Expiration method

<p align="right">(<a href="#readme-top">back to top</a>)</p>

### [#](#) Find method

<p align="right">(<a href="#readme-top">back to top</a>)</p>

### [#](#) Join method

<p align="right">(<a href="#readme-top">back to top</a>)</p>

### [#](#) Count method

<p align="right">(<a href="#readme-top">back to top</a>)</p>

### [#](#) Fallback method

<p align="right">(<a href="#readme-top">back to top</a>)</p>

### [#](#) Always method

<p align="right">(<a href="#readme-top">back to top</a>)</p>

### [#](#) Dashboard

<p align="right">(<a href="#readme-top">back to top</a>)</p>

